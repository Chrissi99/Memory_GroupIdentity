{{ block title }}
{{ if participant.task1 == "luck" }}
    Block 1 - Luck Task
{{ elif participant.task2 == "luck" }}
    Block 2 - Luck Task
{{ elif participant.task3 == "luck" }}
    Block 3 - Luck Task
{{ endif }}
{{ endblock }}
{{ block content }}

<div class="center">
     Click on the die to roll it. You have to roll the die {{C.DICE_ROLLS}} times.
</div>

<div class="dice-container">
      <img id="dice" src="{% static 'global/dice1.png' %}" alt="Roll the dice" class="dice-img">
      <p id="result"></p>
</div>


<div class="center">
    <ul id="rolls-list" class="rolls_list"></ul>
</div>


<form id="rolls-form" method="post">
    <input type="hidden" name="rolls" id="rolls-input">
  </form>

<br>


    <p id="container">
<b class="openbox" id="openbox">
    <button id="next-btn" class="button disabled-button" disabled>Next</button>
</b> </p>

<div class="infobox hidden" id="infobox">
<div class="attention_check">

    {{ formfield 'attention1' }}


        {{ next_button }}

    </div>
</div>

<input type="hidden" name="pagetime_die" id="pagetime_die" value="0">
{{ formfield_errors 'pagetime_die' }}
<input type="hidden" name="focus_data_die" id="id_focus_data" />
{{ formfield_errors 'attention1' }}

{{ endblock }}

{{ block styles }}

<style type="text/css">
.annotatable {
        display: block;
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 20px;
    }

.center {
        text-align: center;
    }

.dice-container {
    text-align: center;
    margin-top: 20px;
}

.dice-img {
    width: 100px;
    cursor: pointer;
}

#result {
    font-size: 20px;
    font-weight: bold;
    margin-top: 10px;
}

#rolls-list {
    list-style-type: none;
    padding: 0;
    font-size: 18px;
}

#rolls-list li {
    font-size: 18px;
}

.enabled-button {
    background-color: #0B60DB;
    border: none;
    border-radius: 7px;
    color: white;
    padding: 7px 14px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    position: relative;
}

.disabled-button {
    border-radius: 7px;
    padding: 7px 14px;
    // background-color: #cccccc;
    // background-color: #DCDCD8;
    background-color: transparent;
    // color: #888888;
    color: transparent;
    cursor: not-allowed;
    border-color: transparent;
}
.openbox {
    cursor: pointer;
	margin: 15px 0;
		  }
.hidden {
	display:none;
}
.infobox {
    // background-color:#f0f0f5
    }
</style>

{{ endblock }}

{{ block scripts }}
<script>
document.addEventListener('DOMContentLoaded', (event) => {
    const dice = document.getElementById('dice');
    const result = document.getElementById('result');
    const nextBtn = document.getElementById('next-btn');
    const rollsForm = document.getElementById('rolls-form');
    const rollsInput = document.getElementById('rolls-input');
    const rollsList = document.getElementById('rolls-list');

    const diceImages = [
        "{% static 'global/dice1.png' %}",
        "{% static 'global/dice2.png' %}",
        "{% static 'global/dice3.png' %}",
        "{% static 'global/dice4.png' %}",
        "{% static 'global/dice5.png' %}",
        "{% static 'global/dice6.png' %}"
    ];

    let rolls = JSON.parse(sessionStorage.getItem('dice_rolls')) || [];
    let allRollsCompleted = sessionStorage.getItem('all_rolls_completed') === 'true';

    function updateRollsList() {
        rollsList.textContent = `Previous Rolls: ${rolls.join(', ')}`;
    }

    function updateNextButton() {
        if (rolls.length === 10) {
            enableNextButton();
        } else {
            disableNextButton();
        }
    }

    function enableNextButton() {
        nextBtn.disabled = false;
        nextBtn.classList.remove('disabled-button');
        nextBtn.classList.add('enabled-button');
    }

    function disableNextButton() {
        nextBtn.disabled = true;
        nextBtn.classList.remove('enabled-button');
        nextBtn.classList.add('disabled-button');
    }

    function updateResultMessage() {
        if (rolls.length === 10) {
            result.textContent = `Your Roll: ${rolls[rolls.length - 1]} - All rolls completed`;
        } else {
            result.textContent = `Your Roll: ${rolls[rolls.length - 1]}`;
        }
    }

    dice.addEventListener('click', () => {
        if (rolls.length < 10) {
            const roll = Math.floor(Math.random() * 6) + 1;
            rolls.push(roll);
            sessionStorage.setItem('dice_rolls', JSON.stringify(rolls));

            if (rolls.length === 10) {
                allRollsCompleted = true;
                sessionStorage.setItem('all_rolls_completed', 'true');
            }

            updateResultMessage();
            dice.src = diceImages[roll - 1];
            updateRollsList();
            updateNextButton();
        }
    });

    nextBtn.addEventListener('click', () => {
        rollsInput.value = JSON.stringify(rolls);
        sessionStorage.removeItem('dice_rolls');
        sessionStorage.removeItem('all_rolls_completed');
        rollsForm.submit();
    });

    // Initialize the UI with any saved rolls
    updateRollsList();
    updateNextButton();

    // Display the result message if all rolls are completed
    if (allRollsCompleted) {
        result.textContent = `Your Roll: ${rolls[rolls.length - 1]} - All rolls completed`;
    } else if (rolls.length > 0) {
        result.textContent = `Your Roll: ${rolls[rolls.length - 1]}`;
    }
});
</script>
<script>
    document.getElementById("openbox").addEventListener("click", function(){
    document.getElementById("infobox").classList.remove("hidden");
    document.getElementById("container").classList.add("hidden");
    });
</script>
<script>
let pageEnterTime = Date.now();

document.querySelector("form").addEventListener("submit", function() {
    let duration = (Date.now() - pageEnterTime) / 1000.0;  // seconds
    document.getElementById("pagetime_die_instr").value = duration.toFixed(2);
});
</script>
<script>
let events = [];

// Beispiel-Logik: push/close Events; ersetze durch deine bestehende Logik
let blurStart = null;
window.addEventListener('blur', () => { blurStart = Date.now(); });
window.addEventListener('focus', () => {
    if (blurStart) {
        events.push({ unfocused_duration_ms: Date.now() - blurStart, ts: blurStart });
        blurStart = null;
    }
});

// Schreib das JSON regelmäßig ins hidden field und beim Verlassen
function updateHidden() {
    document.getElementById('id_focus_data').value = JSON.stringify(events);
}
setInterval(updateHidden, 1000);
window.addEventListener('beforeunload', updateHidden);
document.addEventListener('visibilitychange', updateHidden);
</script>
{{ endblock }}


